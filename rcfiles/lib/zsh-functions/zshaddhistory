local cmd=${1%%$'\n'}

# Only first time through
if [[ -z $acs_session_histfile ]]; then
  #zmodload zsh/parameter
  # acs_session_histfile=$HOME/.hist/$(date '+%Y-%m-%d-%H%M').${HOST%%.*}
  # touch $acs_session_histfile || acs_session_histfile=-~/zsh_detail_history
  # chmod 600 $acs_session_histfile
  acs_session_histfile=$(mktemp)
fi

# Return if command is empty
[[ -z $cmd ]] && return 1

# Ignore history commands, if appropriate
[[ -o histnostore && $cmd =~ "^h$|history|fc " ]] && return 0

# Ignore commands starting with a space, if appropriate
[[ -o histignorespace && $cmd =~ "^ .*" ]] && return 0

# Save all commands (along with time and current directory)
# to a special per-shell file
print -- "$(now); $PWD; $cmd" >> $acs_session_histfile

# Save command to in-memory history list
print -sr -- $cmd

# Local Variables:
# mode: shell-script
# sh-indentation: 2
# indent-tabs-mode: nil
# End:
